{% extends "base.html" %}

{% block title %}Manage Products{% endblock %}

{% block content %}
<h1 class="mb-4 text-danger">Product Management</h1>

<nav class="nav nav-pills nav-fill mb-4">
    <a class="nav-link bg-secondary text-white" href="{{ url_for('admin_dashboard') }}">Dashboard</a>
    <a class="nav-link active" href="{{ url_for('manage_products') }}">Product Management</a>
    <a class="nav-link bg-secondary text-white" href="{{ url_for('manage_orders') }}">Order Management</a>
</nav>

<!-- Add New Product Form (Collapse to save space) -->
<p>
    <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAddProduct" aria-expanded="false" aria-controls="collapseAddProduct">
        + Add New Product
    </button>
</p>
<div class="collapse mb-4" id="collapseAddProduct">
    <div class="card card-body">
        <h4 class="mb-3">Add Product</h4>
        <form method="POST" action="{{ url_for('manage_products') }}">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="name" class="form-label">Name</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="image" class="form-label">Image Path (static/images/)</label>
                    <input type="text" class="form-control" id="image" name="image" value="default.jpg" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="category" class="form-label">Category</label>
                    <select class="form-select" id="category" name="category" required>
                        {% for cat in categories %}
                            <option value="{{ cat }}" {% if cat == 'Other' %}selected{% endif %}>{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="price" class="form-label">Price ($)</label>
                    <input type="number" step="0.01" min="0" class="form-control" id="price" name="price" required>
                </div>
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
            </div>
            <div class="mb-3">
                <label for="stock" class="form-label">Stock Quantity</label>
                <input type="number" min="0" class="form-control" id="stock" name="stock" required>
            </div>
            <button type="submit" class="btn btn-success">Save Product</button>
        </form>
    </div>
</div>


<!-- Product List -->
<h2>Product List</h2>
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Category</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>{{ product.id }}</td>
                <td>{{ product.name }}</td>
                <td><span class="badge bg-secondary">{{ product.category }}</span></td>
                <td>â‚¹{{ "%.2f"|format(product.price) }}</td>
                <td><span class="badge {% if product.stock > 10 %}bg-success{% elif product.stock > 0 %}bg-warning text-dark{% else %}bg-danger{% endif %}">{{ product.stock }}</span></td>
                <td>
                    <!-- Edit Button triggers a separate page -->
                    <a href="{{ url_for('edit_product', product_id=product.id) }}" class="btn btn-sm btn-info text-white">Edit</a>
                    
                    <!-- Delete Form -->
                    <form action="{{ url_for('delete_product', product_id=product.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete {{ product.name }}?');">
                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}